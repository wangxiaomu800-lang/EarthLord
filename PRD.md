# 地球新主 (EarthLord) - 产品需求文档 (PRD)

## 文档信息
- **版本**: v1.0
- **更新日期**: 2025-12-23
- **产品名称**: 地球新主 (EarthLord)
- **产品类型**: LBS生存游戏 (Location-Based Service)
- **目标平台**: iOS (App Store全球175个国家)

---

## 1. 产品概述

### 1.1 产品定位
地球新主是一款基于真实地理位置的末日生存开拓游戏,玩家通过在现实世界中行走来圈占虚拟领地、探索废墟、收集资源、建造家园,并与其他玩家交易和社交。

### 1.2 核心价值主张
**"凡以双足丈量之无主土地,皆为开拓者所有"**

- **Walk to Earn**: 走路即可获得游戏资源和领地
- **真实地理映射**: 基于苹果地图的真实POI数据
- **社交互动**: 基于地理位置的公共聊天和交易系统
- **希望朋克风格**: 废土中的新生与希望,正能量的末日题材

### 1.3 产品愿景
打造全球首款深度结合GPS圈地与生存建造的移动游戏,让玩家在日常通勤和运动中即可游玩,成为新一代"宝可梦GO"级别的现象级产品。

---

## 2. 目标用户

### 2.1 主要用户画像

#### 画像1: 运动爱好者
- **年龄**: 25-40岁
- **特征**: 喜欢跑步、骑行等户外运动,使用Keep、咕咚等运动App
- **痛点**: 运动缺乏趣味性,难以坚持
- **诉求**: 希望运动过程更有趣,有额外激励

#### 画像2: 游戏玩家
- **年龄**: 18-35岁
- **特征**: 喜欢生存建造类游戏(如《饥荒》《方舟》),有付费习惯
- **痛点**: 传统游戏久坐不健康,希望游戏与运动结合
- **诉求**: 既能玩游戏又能锻炼身体

#### 画像3: 社交探索者
- **年龄**: 20-35岁
- **特征**: 喜欢探索城市、打卡地标,热衷于LBS社交
- **痛点**: 传统社交App缺乏新鲜感
- **诉求**: 基于地理位置的新型社交体验

### 2.2 用户规模预估
- **全球运动App市场**: 超过5亿活跃用户
- **LBS游戏市场**: 宝可梦GO累计下载量超10亿次
- **目标**: 第一年获取100万注册用户,10万DAU

---

## 3. 产品目标

### 3.1 商业目标
- **收入目标**: 上线6个月内实现盈亏平衡
- **付费转化率**: 5% (行业平均水平)
- **ARPU**: $15/月 (每付费用户月均收入)

### 3.2 用户目标
- **次日留存**: >40%
- **7日留存**: >25%
- **30日留存**: >15%
- **日活/月活比**: >30%

### 3.3 技术目标
- **App启动时间**: <3秒
- **GPS定位精度**: <10米
- **消息延迟**: <1秒
- **崩溃率**: <0.1%

---

## 4. 核心功能需求

### 4.1 功能架构图

```
地球新主
├── 用户系统
│   ├── 登录注册 (邮箱/Apple/Google)
│   ├── 个人资料
│   └── 多语言设置
├── 圈地系统
│   ├── GPS轨迹绘制
│   ├── 领地创建
│   ├── 领地管理
│   └── 地理空间数据库
├── 探索系统
│   ├── POI发现
│   ├── 搜刮奖励
│   ├── 探索成就
│   └── 地理围栏
├── 资源系统
│   ├── 背包管理
│   ├── 资源分类
│   └── 容量限制
├── 建造系统
│   ├── 建筑模板
│   ├── 资源消耗
│   ├── 建筑状态机
│   └── 建筑升级
├── 交易系统
│   ├── 挂单交易
│   ├── 位置触发
│   └── 交易确认
├── 通讯系统
│   ├── 消息中心
│   ├── 公共频道
│   ├── 私人频道
│   ├── PTT呼叫
│   └── 设备等级
├── 社交系统
│   ├── 排行榜
│   ├── 成就系统
│   └── 好友系统
├── 生存系统
│   ├── 生命值
│   ├── 饱食度
│   ├── 水分
│   └── 时间衰减
└── 商业化系统
    ├── 订阅制会员
    ├── 资源包购买
    └── StoreKit内购
```

### 4.2 功能优先级划分

#### P0 (MVP必需功能)
1. **用户系统**: 登录注册(邮箱/Apple/Google)
2. **圈地系统**: GPS轨迹绘制 + 领地创建
3. **探索系统**: POI发现 + 搜刮奖励
4. **资源系统**: 背包管理
5. **建造系统**: 基础建筑(篝火、仓库)

#### P1 (核心体验功能)
6. **交易系统**: 玩家间物品交易
7. **通讯系统**: 公共频道聊天
8. **生存系统**: 饱食度/水分衰减
9. **商业化系统**: 订阅制会员

#### P2 (增强功能)
10. **排行榜系统**: 领地/探索/建筑榜
11. **成就系统**: 新手引导成就
12. **频道管理**: 自定义频道
13. **PTT呼叫**: 语音对讲

---

## 5. 功能详细需求

### 5.1 用户系统

#### 5.1.1 登录注册
**需求描述**: 用户可通过多种方式注册和登录

**支持方式**:
- 邮箱+密码注册
- Apple登录 (OAuth)
- Google登录 (OAuth)

**功能要求**:
- 邮箱验证机制
- 密码找回功能
- 会话管理(支持多设备登录)
- 自动登录(Token有效期内)

**技术方案**: Supabase Auth

#### 5.1.2 个人资料
**需求描述**: 展示玩家游戏数据和成就

**展示内容**:
- 幸存者等级
- 存活天数
- 领地数量和总面积
- 建筑数量
- 探索成就

**交互要求**:
- 可编辑昵称和头像
- 数据实时同步

### 5.2 圈地系统

#### 5.2.1 GPS轨迹绘制
**需求描述**: 玩家移动时,在地图上绘制蓝色轨迹线

**功能要求**:
- 实时获取GPS位置(精度<10米)
- 轨迹点间隔:每5秒或每10米记录一次
- 轨迹可视化:蓝色半透明折线
- 支持暂停/继续

**技术方案**:
- 使用MapKit框架
- CLLocationManager定位
- MKPolyline绘制轨迹

#### 5.2.2 领地创建
**需求描述**: 轨迹闭合后形成领地多边形

**触发条件**:
- 当前位置距离起点<50米
- 轨迹点数量≥4个
- 面积>100平方米

**验证规则**:
- 不与已有领地重叠
- 形状为简单多边形(无自交)
- 面积≤100,000平方米

**奖励机制**:
- 首次圈地奖励100金币
- 面积越大奖励越多

**技术方案**: PostGIS地理空间数据库

#### 5.2.3 领地管理
**需求描述**: 查看和管理已拥有的领地

**功能列表**:
- 领地列表展示
- 领地详情(名称、面积、建筑)
- 领地命名/重命名
- 允许交易开关
- 领地删除(回收)

**业务规则**:
- 30天内无建造活动,领地警告
- 90天无活跃,领地自动回收

### 5.3 探索系统

#### 5.3.1 POI发现
**需求描述**: 玩家靠近真实地标时触发探索

**地理围栏**:
- 触发范围:POI周围100米
- 每个POI每24小时可搜刮1次

**POI类型分类**:
- 医院/药店 → 药品
- 超市/餐厅 → 食物
- 工厂/工地 → 金属材料
- 公园/林地 → 木材
- 银行/珠宝店 → 稀有材料

**技术方案**: 苹果MapKit POI数据 + MKCircle地理围栏

#### 5.3.2 搜刮奖励
**需求描述**: 完成探索后获得资源奖励

**奖励计算**:
- 基础奖励:根据POI类型
- 距离加成:探索距离越远奖励越多
- 稀有度:5%概率获得稀有物品

**UI展示**:
- 探索成就页面
- 探索距离、时长统计
- 获得物品列表

### 5.4 资源系统

#### 5.4.1 背包管理
**需求描述**: 存储和管理收集到的物品

**容量限制**:
- 初始容量:100格
- 可通过建造仓库扩容
- 单个物品可堆叠(如:罐头×24)

**物品分类**:
- 食物:罐头、饮用水等
- 药品:急救包、抗生素等
- 材料:木材、金属、布料等
- 稀有:卫星模块、电子元件等

**功能要求**:
- 物品排序(按类型/稀有度)
- 物品使用(食物恢复饱食度)
- 物品丢弃

**技术方案**: 本地优先架构(SQLite本地存储 + Supabase云端同步)

### 5.5 建造系统

#### 5.5.1 建筑模板
**需求描述**: 预定义的建筑类型和配方

**建筑分类**:
- **Tier 1 - 生存基础**
  - 篝火:石头×20,木材×30
  - 简易庇护所:木材×50,布料×20
  - 小仓库:木材×40,金属×10

- **Tier 2 - 功能扩展**
  - 工作台:木材×60,金属×30
  - 农田:木材×20,种子×5
  - 中型仓库:木材×80,金属×40

- **Tier 3 - 高级设施**
  - 太阳能板:金属×100,电子元件×20
  - 风力发电机:金属×150,电子元件×30
  - 卫星通讯站:稀有材料×50,卫星模块×5

#### 5.5.2 建造流程
**交互步骤**:
1. 进入领地详情页
2. 点击"建造"按钮
3. 选择建筑类型
4. 检查资源是否足够
5. 拖动图标选择位置
6. 确认建造

**业务规则**:
- 只能在自己的领地上建造
- 建筑不能重叠
- 资源不足时提示并阻止建造

#### 5.5.3 建筑状态机
**状态流转**:
```
[建造中] → [待激活] → [运行中] → [损坏]
                ↓           ↓
             [升级]      [维修]
```

**状态说明**:
- **建造中**: 施工中(10分钟)
- **待激活**: 建好但未开启
- **运行中**: 正常工作
- **损坏**: 需要维修

**操作限制**:
- 只能升级"运行中"状态的建筑
- 损坏建筑需先维修

### 5.6 交易系统

#### 5.6.1 挂单交易
**需求描述**: 玩家之间以物易物

**挂单流程**:
1. 选择"我提供"的物品和数量
2. 选择"我需要"的物品和数量
3. 发布挂单

**触发条件**:
- 领地设置"允许交易"
- 其他玩家进入领地100米范围
- 双方设备在线

**交易流程**:
1. 买家查看挂单
2. 买家接受交易
3. 系统检查双方资源
4. 扣除资源并完成交易
5. 双方收到通知

**防作弊机制**:
- 交易记录上链(可追溯)
- 冷却时间:每个物品1小时内最多交易3次

### 5.7 通讯系统

#### 5.7.1 公共频道
**需求描述**: 基于地理位置的公共聊天室

**覆盖范围**:
- 收音机(只读):3km范围
- 对讲机(读写):3km范围
- 营地电台:10km范围
- 卫星通讯:全球范围

**消息展示**:
- 实时推送(Supabase Realtime)
- 显示发送者昵称和距离
- 支持文本消息(未来支持图片/语音)

**业务规则**:
- 消息保留24小时
- 禁言机制(举报后)

#### 5.7.2 频道管理
**需求描述**: 玩家可创建和加入自定义频道

**频道类型**:
- 公共频道:任何人可加入
- 私人频道:需要邀请

**频道属性**:
- 频道名称(最多20字符)
- 频道描述
- 成员列表
- 在线人数

**管理功能**:
- 创建频道
- 加入/退出频道
- 踢出成员(仅创建者)

#### 5.7.3 PTT呼叫
**需求描述**: 模拟真实对讲机的按键通话

**交互方式**:
- 长按麦克风按钮说话
- 松开按钮发送
- 其他人实时收听

**技术方案**:
- 录音:AVAudioRecorder
- 实时传输:WebRTC或Supabase Realtime
- 播放:AVAudioPlayer

### 5.8 生存系统

#### 5.8.1 生存体征
**需求描述**: 角色有生命值和需求值,随时间衰减

**数值设计**:
- **核心生命**: 初始100,降到0死亡
- **饱食度**: 初始100%,每小时-5%
- **水分**: 初始100%,每小时-10%

**衰减机制**:
- 每10分钟检查一次
- 饱食度<20%时,生命值每小时-10
- 水分<20%时,生命值每小时-15

**增益机制**:
- 饱食度和水分>80%时,探索奖励+20%

**恢复方式**:
- 使用食物恢复饱食度
- 使用水恢复水分
- 死亡后复活,数值重置为50%

### 5.9 排行榜系统

#### 5.9.1 榜单类型
- **领地面积榜**: 按总面积排序
- **探索废墟榜**: 按探索次数排序
- **建筑数量榜**: 按建筑总数排序

#### 5.9.2 排名规则
- 每5分钟更新一次
- 显示前100名
- 显示玩家自己的排名

**技术方案**: PostgreSQL窗口函数 + Redis缓存

### 5.10 成就系统

#### 5.10.1 成就分类

**新手成就**:
- 新手领主:完成第一次圈地(奖励100金币)
- 末世拾荒者:完成第一次搜刮(奖励50金币)
- 建造者:建造第一个建筑(奖励100金币)

**进阶成就**:
- 地产大亨:拥有5块领地(奖励500金币)
- 探索家:探索100个POI(奖励1000金币)
- 建筑师:建造20个建筑(奖励1000金币)

**稀有成就**:
- 领主:领地总面积>100,000m²(奖励5000金币)
- 废墟探险家:探索500个POI(奖励10000金币)

#### 5.10.2 成就触发
**技术方案**: EventBus发布-订阅模式
- 玩家完成动作 → 发出事件
- 成就系统订阅事件 → 检查是否达成
- 达成后发放奖励并推送通知

---

## 6. 非功能性需求

### 6.1 性能要求
- **GPS定位延迟**: <2秒
- **地图渲染**: 60 FPS
- **消息推送延迟**: <1秒
- **数据库查询**: <500ms

### 6.2 安全要求
- **数据加密**: 敏感数据使用AES-256加密
- **传输安全**: 全部使用HTTPS
- **防作弊**: GPS数据验证,防止虚拟定位
- **隐私保护**: 遵守GDPR和Apple隐私政策

### 6.3 兼容性要求
- **iOS版本**: iOS 15.0及以上
- **设备支持**: iPhone 8及以后机型
- **网络要求**: 4G/5G/WiFi (离线模式有限功能)

### 6.4 可用性要求
- **可用性**: 99.5%
- **故障恢复**: <1小时
- **数据备份**: 每日自动备份

---

## 7. 商业模式

### 7.1 收入模式

#### 7.1.1 订阅制会员
**开拓者月卡** - $9.99/月
- 无限探索次数(普通用户每日5次)
- 探索范围扩大到10km(普通3km)
- 背包容量+50格
- 资源掉落率+20%

**领主通行证** - $19.99/月
- 包含月卡所有特权
- 圈地范围扩大到200,000m²
- 建造时间减半
- 专属建筑皮肤

#### 7.1.2 一次性购买
**资源包**:
- 初级物资包 - $0.99 (食物×50,水×50)
- 中级物资包 - $2.99 (食物×150,水×150,药品×20)
- 高级物资包 - $4.99 (全部资源×100)
- 稀有资源包 - $9.99 (卫星模块×5,电子元件×10)

**建筑包**:
- 速建券 - $1.99 (立即完成建造)
- 维修券 - $0.99 (修复损坏建筑)

### 7.2 成本估算

**开发成本**:
- 使用AI辅助开发,个人开发者成本<$5,000

**运营成本**(月):
- Supabase服务: $25/月 (Pro计划)
- App Store开发者账号: $99/年 ≈ $8/月
- 服务器带宽: 按实际使用量计费,预估$50/月
- **合计**: ~$83/月

**盈亏平衡点**:
- 假设5%付费转化率,ARPU $15/月
- 需要付费用户数: $83 ÷ $15 ≈ 6人
- 需要总用户数: 6 ÷ 5% = 120人

### 7.3 增长策略

#### 7.3.1 获客渠道
- App Store优化(ASO): 关键词"GPS游戏"、"运动赚钱"
- 社交媒体营销: TikTok、Instagram短视频
- KOL合作: 运动博主、游戏主播
- 病毒传播: 邀请好友奖励机制

#### 7.3.2 留存策略
- 每日签到奖励
- 每日任务系统
- 限时活动(双倍奖励周末)
- 社交绑定(公会系统)

#### 7.3.3 付费转化策略
- 新手礼包($0.99首充)
- 限时优惠(首月半价)
- VIP特权展示(对比表)
- 稀缺资源(部分资源只能购买)

---

## 8. 技术架构

### 8.1 技术栈

**前端**:
- 语言: Swift 5.9
- UI框架: SwiftUI
- 地图: MapKit
- 定位: CoreLocation
- 音频: AVFoundation
- 支付: StoreKit 2
- 本地存储: SwiftData / SQLite

**后端**:
- BaaS: Supabase
  - 数据库: PostgreSQL + PostGIS
  - 认证: Supabase Auth
  - 实时推送: Supabase Realtime
  - 存储: Supabase Storage

**基础设施**:
- 版本控制: Git
- CI/CD: GitHub Actions
- 分析: App Store Connect Analytics

### 8.2 数据库设计

**核心表结构**:
- `users`: 用户信息
- `territories`: 领地数据(PostGIS geometry)
- `buildings`: 建筑数据
- `items`: 物品模板
- `inventories`: 背包物品
- `trades`: 交易记录
- `messages`: 聊天消息
- `channels`: 频道信息
- `achievements`: 成就数据
- `vital_signs`: 生存体征

### 8.3 架构模式
- **MVVM**: Model-View-ViewModel
- **本地优先**: 离线可用,在线同步
- **EventBus**: 解耦模块通讯
- **Repository模式**: 统一数据访问层

---

## 9. 项目里程碑

### Phase 1: MVP (2个月)
**目标**: 完成核心玩法,内部测试

**功能范围**:
- ✅ 用户系统(登录注册)
- ✅ 圈地系统(GPS轨迹+领地创建)
- ✅ 探索系统(POI发现+搜刮)
- ✅ 背包系统
- ✅ 建造系统(Tier 1建筑)

**验收标准**:
- 完成完整游戏循环
- 无重大Bug
- 核心功能可用

### Phase 2: Beta (1个月)
**目标**: 完善社交功能,公测

**功能范围**:
- ✅ 交易系统
- ✅ 公共频道聊天
- ✅ 生存系统
- ✅ 成就系统
- ✅ 商业化系统(内购)

**验收标准**:
- 完成全部P0+P1功能
- 500人封闭测试
- 次日留存>30%

### Phase 3: 正式上线 (1个月)
**目标**: App Store全球上架

**功能范围**:
- ✅ 排行榜系统
- ✅ 频道管理
- ✅ PTT呼叫
- ✅ 多语言(中文/英文)
- ✅ 性能优化
- ✅ 安全加固

**验收标准**:
- 通过App Store审核
- 全部功能稳定
- 性能指标达标

### Phase 4: 运营优化 (持续)
**目标**: 用户增长和变现优化

**重点工作**:
- 数据分析和A/B测试
- 活动运营
- 版本迭代
- 社区运营

---

## 10. 风险评估

### 10.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| GPS精度不足 | 高 | 中 | 增加数据过滤算法,要求权限"精确定位" |
| 虚拟定位作弊 | 高 | 高 | 检测模拟器,速度异常检测,行为分析 |
| 后端性能瓶颈 | 中 | 低 | Supabase自动扩容,增加缓存机制 |
| 消息延迟 | 中 | 中 | 优化Realtime连接,增加离线消息队列 |

### 10.2 商业风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 用户增长缓慢 | 高 | 中 | 增加营销预算,优化ASO,病毒传播机制 |
| 付费转化率低 | 高 | 中 | 优化付费点设计,增加免费试用 |
| 竞品出现 | 中 | 高 | 快速迭代,建立社区壁垒 |
| 政策监管 | 高 | 低 | 遵守各地法规,避免敏感内容 |

### 10.3 运营风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 用户流失 | 高 | 中 | 每日任务,活动运营,社交绑定 |
| 社区管理 | 中 | 高 | 自动审核+人工审核,举报机制 |
| 客服压力 | 中 | 中 | FAQ文档,聊天机器人,社区自助 |

---

## 11. 成功指标 (KPI)

### 11.1 用户指标
- **注册用户数**: 目标100万/年
- **DAU**: 目标10万
- **MAU**: 目标50万
- **DAU/MAU比**: >20%

### 11.2 留存指标
- **次日留存**: >40%
- **7日留存**: >25%
- **30日留存**: >15%

### 11.3 参与度指标
- **日均游玩时长**: >30分钟
- **日均圈地次数**: >1次
- **日均探索次数**: >3次

### 11.4 商业指标
- **付费转化率**: >5%
- **ARPU**: >$15/月
- **LTV**(生命周期价值): >$200
- **CAC**(获客成本): <$10

---

## 12. 附录

### 12.1 术语表
- **LBS**: Location-Based Service,基于位置的服务
- **POI**: Point of Interest,兴趣点
- **DAU**: Daily Active Users,日活跃用户
- **MAU**: Monthly Active Users,月活跃用户
- **ARPU**: Average Revenue Per User,每用户平均收入
- **LTV**: Lifetime Value,用户生命周期价值
- **CAC**: Customer Acquisition Cost,获客成本

### 12.2 参考资料
- 宝可梦GO商业模式分析
- Keep运动App产品分析
- Supabase官方文档
- Apple MapKit开发文档
- App Store审核指南

---

## 13. 审批记录

| 版本 | 日期 | 审批人 | 状态 |
|------|------|--------|------|
| v1.0 | 2025-12-23 | - | 草稿 |

---

**文档结束**
