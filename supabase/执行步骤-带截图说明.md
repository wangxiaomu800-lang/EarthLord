# 🎯 执行 SQL Migration - 详细步骤

## 前置准备（1 分钟）

1. **复制 SQL 代码**
   - 打开文件：`supabase/migrations/20251226_create_core_tables.sql`
   - 全选所有内容：**Command + A**（Mac）或 **Ctrl + A**（Windows）
   - 复制：**Command + C**（Mac）或 **Ctrl + C**（Windows）
   - ✅ SQL 代码已在剪贴板中

---

## 执行步骤（2 分钟）

### 步骤 1: 打开 Supabase 项目

访问以下链接（会直接打开你的项目）：
```
https://vuqfufnrxzsmkzmhtuhw.supabase.co
```

**如果需要登录**：使用你的 Supabase 账号登录

---

### 步骤 2: 进入 SQL Editor

**方法 A - 直接链接（推荐）**：
```
https://supabase.com/dashboard/project/vuqfufnrxzsmkzmhtuhw/sql
```

**方法 B - 手动导航**：
1. 在项目页面左侧菜单中找到 **SQL Editor**
   - 图标是一个数据库符号 `{;}`
   - 或者在搜索框输入 "SQL"
2. 点击进入

---

### 步骤 3: 创建新查询

在 SQL Editor 页面：
1. 点击右上角的 **"New query"** 按钮
   - 或者使用快捷键：`Command + K`（Mac）/ `Ctrl + K`（Windows）

---

### 步骤 4: 粘贴并执行 SQL

1. **粘贴 SQL 代码**
   - 在编辑器中粘贴：**Command + V**（Mac）或 **Ctrl + V**（Windows）
   - 你应该看到完整的 SQL 代码（226 行）

2. **执行 SQL**
   - 点击右下角绿色的 **"Run"** 按钮
   - 或使用快捷键：**Command + Enter**（Mac）/ **Ctrl + Enter**（Windows）

3. **等待执行**
   - 通常需要 2-5 秒
   - 底部会显示进度

---

### 步骤 5: 验证执行结果

**成功标志**：
- ✅ 底部显示 "Success. No rows returned"
- ✅ 没有红色错误提示

**验证表是否创建成功**：
1. 点击左侧菜单的 **"Table Editor"**
2. 应该看到 3 个新表：
   - `profiles`
   - `territories`
   - `pois`

---

## 🎉 完成后测试

### 在应用中测试连接

1. 打开 EarthLord 应用
2. 进入 **"更多"** 标签页
3. 点击 **"Supabase 连接测试"**
4. 点击 **"测试连接"** 按钮

**预期结果**：
```
📡 步骤 1/2: 测试 Supabase 服务器连接...
✅ 基本连接成功（服务器已响应）

📊 步骤 2/2: 检查数据表是否已创建...
✅ profiles 表存在！
✅ 数据库配置完成！

🎉 恭喜！Supabase 已完全配置成功！
```

---

## ❓ 常见问题排查

### Q1: 执行时提示 "permission denied"

**原因**：没有权限执行 SQL
**解决**：
- 确保你已登录正确的 Supabase 账号
- 确保你是项目的所有者或管理员
- 尝试刷新页面重新登录

---

### Q2: 执行时提示 "already exists"

**原因**：表已经创建过了
**解决**：这是好消息！说明表已经存在了
- 直接跳到"完成后测试"步骤验证即可

---

### Q3: 执行时提示 "syntax error"

**原因**：SQL 代码不完整或格式错误
**解决**：
1. 确保复制了**完整的** SQL 文件内容（所有 226 行）
2. 检查文件开头是否是注释：`-- 地球新主 - 核心数据表创建脚本`
3. 检查文件结尾是否有：`COMMENT ON COLUMN public.pois.discovered_by...`
4. 如果不确定，重新打开文件并再次复制

---

### Q4: 不确定是否执行成功？

在 SQL Editor 中执行以下查询来检查：

```sql
-- 检查表是否存在
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('profiles', 'territories', 'pois')
ORDER BY table_name;
```

**预期结果**：应该返回 3 行
- pois
- profiles
- territories

---

### Q5: 我想重新开始怎么办？

如果需要删除所有表并重新创建：

```sql
-- ⚠️ 警告：这会删除所有表和数据！
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
DROP TRIGGER IF EXISTS update_territories_updated_at ON public.territories;
DROP TRIGGER IF EXISTS update_profiles_updated_at ON public.profiles;

DROP TABLE IF EXISTS public.pois CASCADE;
DROP TABLE IF EXISTS public.territories CASCADE;
DROP TABLE IF EXISTS public.profiles CASCADE;

DROP FUNCTION IF EXISTS public.handle_new_user() CASCADE;
DROP FUNCTION IF EXISTS update_updated_at_column() CASCADE;

DROP TYPE IF EXISTS poi_type CASCADE;
```

然后重新执行 migration 文件。

---

## 📞 需要帮助？

如果遇到其他问题：
1. 检查 Supabase 状态页：https://status.supabase.com
2. 查看 Supabase 文档：https://supabase.com/docs
3. 截图错误信息并寻求帮助

---

## 🚀 下一步

数据库配置完成后，你可以：

1. ✅ 测试连接（使用应用中的测试页面）
2. ✅ 开始实现用户认证功能
3. ✅ 开发领地绘制功能
4. ✅ 实现 POI 发现功能

祝你游戏开发顺利！🎮
